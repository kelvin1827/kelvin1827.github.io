# 用户手册

For 制品库存管理目视化系统 `Version` `0.8.x`<br>Last updated by `LIUKAI` at `2019/4/29`

---

## 目录

* [系统概要](#系统概要)
* [系统操作](#系统操作)
  * [数据汲取](#数据汲取)
  * [数据入库](#数据入库)
  * [生成图表](#生成图表)

---

## 制品库存管理目视化系统  {#系统概要}

### 系统目的

通过获取品番别的**生成计划**、**生成日报**以及**销售出库**的信息，自动记录、计算各品番的库存数量，并通过图表的形式，输出相应品番的**库存变动**情况的自动化系统。

### 系统构成

#### 系统的总体构成

系统由如下表所示的**文件夹**及**文件**所构成。

|No|构成名称|文件类型|作用|
|---:|---|---|---|
|1|`00Database`|文件夹|存放**主数据库**文件|
|2|`TSHStore.accdb`|数据库文件|**主数据库**文件<br>位于文件夹<br>`00Database`中|
|3|`01Before`|文件夹|存放==待提取==信息<br>的`Excel`文件|
|4|`10NeedCheck`|文件夹|存放提取信息时<br>发生==错误==，待确认<br>的`Excel`文件|
|5|`11Planning`|文件夹|存放信息提取成功<br>的**生产计划**文件|
|6|`11Production`|文件夹|存放信息提取成功<br>的**生产日报**文件|
|7|`11Shipped`|文件夹|存放信息提取成功<br>的**销售出库**文件|
|8|`综合管理面板.xlsm`|`Excel`文件|**综合管理面板**文件<br>位于外层根目录下<br>是程序的**主控制文件**|

#### 主控`Excel`文件的构成

下记是主控制文件`综合管理面板.xlsm`中不可或缺的三个工作表`Worksheet`。

|No|表名称|说明|
|---:|---|---|
|1|`main`|综合管理面板所在工作表|
|2|`db_io`|*数据暂存工作表*<br>用于存放从计划、生产、出库等<br>`Excel`表中提取的数据。<br>数据库**经由此表**获取数据，<br>并在表中记录入库的时间|
|3|`logs`|*执行过程记录表*<br>记录读取到的各`Excel`表<br>名称、时间、获取的数据量<br>及是否发生错误的信息表|

> 每次启动主控文件时，系统将自动确认主控文件中是否存在这三个表。
> 如发现有缺失，系统会自动生成相应的表。

---

## 系统操作 {#系统操作}

### 数据汲取 {#数据汲取}

#### 生产计划文件

> **生产计划**文件是记录各品番每日每值**计划生产数量**的文件

##### 导入步骤

###### `Step1`

将**生产计划**文件复制到`01Before`文件夹中。

###### `Step2` ==留意点==

1. 打开`01Before`文件夹中的**生产计划**文件，确认已选中`生产日计划`工作表。
2. 确认`生产日计划`工作表中以下各区域的内容：

| No | 单元格/列 | 内容/项目 | 备注 |
|---:|:---:|---|---|
|1| `A1`|`生产日计划`|表单类型识别用|
|2|`B` 列|零件号|须为`12`位全品番|
|3|`N` 列|班次`A`产量|须为**数字**|
|4|`O2`|`A`班计划日期|须为**日期**格式|
|5|`R2`|班次信息：`A`|不可合并|
|6|`T` 列|班次`B`产量|须为**数字**|
|7|`U2`|`B`班计划日期|须为**日期**格式|
|8|`X2`|班次信息：`B`|不可合并|

3. 确认以上内容无误之后，**保存并关闭**文件。

###### `Step3`

打开`V0.8.x综合管理面板.xlsm`文件，定位到`main`工作表。

###### `Step4`

点击`main`工作表中的`数据汲取`按钮，启动数据搜集程序。

##### 数据读取成功后

**生产计划**文件将被重新命名，并移动到`11Planning`文件夹。
   * 如表头有问题，弹出**表头有误**提示对话框，停止执行程序，文件保留在原处。
  * 如发生其他问题，**生产计划**文件将被==重新命名==并移动至`10NeedCheck`文件夹。

#### 生产日报文件

> **生产日报**文件是记录各品番每日每值**实际生产数量**的文件

##### 导入步骤

###### `Step1`

将**生产日报**文件复制到`01Before`文件夹中。

###### `Step2` ==留意点==

1. 打开`01Before`文件夹中**生产日报**文件，确认已选中`日明细`工作表。
2. 确认`日明细`工作表中以下各区域的内容：

| No | 单元格/列 | 内容 | 备注 |
|---:|:---:|---|---|
|1|`A` 列|数据已读取<br>标记日期|==自动记入==<br>**非常重要**<br>系统会根据此列判断<br>每行数据的读取与否，<br>请务必注意避免读入<br>**重复的数据**，从而导致<br>在库计算结果产生偏差|
|2|`B` 列|生产日期|人工记入|
|3|`S` 列|合格数|须为**数字**|
|4|`F2`|班次信息：<br>`A`或者`B`|不可合并|

3. 确认以上内容无误之后，**保存并关闭**文件。

###### `Step3`

打开`V0.8.x综合管理面板.xlsm`文件，定位到`main`工作表。

###### `Step4`

点击`main`工作表中的`数据汲取`按钮，启动数据搜集程序。

##### 数据读取成功后

**生产日报**文件将被保留在`01Before`文件夹中。

* 如读取不成功，**生产日报**文件将被==重新命名==并移动至`10NeedCheck`文件夹。

---

### 数据入库 {#数据入库}

成功读取到的数据，会被暂存在**综合管理面板**文件中的`db_io`工作表中。

打开`main`工作表，点击其中的`数据入库`按钮，系统会将`db_io`工作表中暂存的数据，写入位于`00Database`文件夹中的数据库中。

对于成功写入数据库的行，系统会在`db_io`工作表的`G`列中，记入**数据写入的日期**信息。

---

### 生成图表 {#生成图表}

#### 准备工作

##### `Step1`

打开`V0.8.x综合管理面板.xlsm`文件，定位到`main`工作表。

##### `Step2`

从`main`工作表的`B9`单元格开始，填写需要生成图表的**品番**等相关信息，详细如下：

|列号|列名|记入方式|内容/注意事项|
|---|---|---|---|
|`B`|品番|人工|须要生成图表的品番<br>须为`12`位全品番|
|`C`|品名|自动|`B`列品番所对应的品名<br>由系统根据`B`列的记入信息，<br>自动查询并填写|
|`D`|开始日期|人工|图表中显示的起始日期<br>须为**日期格式**|
|`E`|改善前目标值|人工|须为**整数**，单位：箱|
|`F`|改善后目标值|人工|须为**整数**，单位：箱|
|`G`|收容数|自动|由系统根据`B`列的记入信息，<br>自动查询并填写|
|`H`|初始在库个数|自动|由系统根据`B`列的记入信息，<br>自动查询并填写|

##### `Step3`

系统在自动生成图表时，以品番为单位，每个品番输出包含下记内容的**图表套装**:

1. 表头以及品番、品名等基本信息
2. 该品番的**在库信息柱状图**
3. 该品番的**在库信息详细数据表**

系统会在此工作簿中，建立新的工作表，用于存放输出的图表套装，并自动此工作表设置为**横向`A3`的打印区域**，用户可以控制每个新工作表中所存放的图表套装数量。

在`main`工作表的`F4`单元格中，**选择**生成图表时每页**图表套装**的数量，默认为每张`A3`页面**存放`3`个**图表套装。

|每页图表数量|印刷设定纸张的尺寸|新工作表中品番数量|
|---:|---:|---:|
|`1`|`A3`|`1` 个|
|`2`|`A3`|`2` 个|
|`3`|`A3`|`3` 个|

#### 执行`生成图表`程序

点击`生成图表`按钮，启动系统，以下内容为自动化作业，内容为作业的过程，**请参考**。

##### 自动化 `Step1`

系统会从`main`工作表的`B9`单元格开始，自上而下逐一读取`品番`信息，

> 根据`品番`信息从`00Database`文件夹的数据库中，查询出相应的`品名`,`收容数`,`初始在库个数`信息，并记入到此表中

直到`品番`列为空值，结束读取。

##### 自动化 `Step2`

系统会从`main`工作表的`B9`单元格开始，自上而下逐一读取`品番`信息，

> 系统会新建一张工作表，根据`品番`及其他相关信息，从数据库中查询并计算所需数据，并根据每页图表数量`n`的设定，在新工作表中写入该品番的**图表套装**，直到该工作表中的品番数量达到`n`个，系统再新建一张工作表，继续工作循环。

直到`品番`列为空值，结束整个工作循环。

**The End**

---

&copy; `LIUKAI` `2019`
